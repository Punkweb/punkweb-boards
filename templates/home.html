{% extends 'base.html' %}
{% load static %}
{% load bbcode_tags %}

{% block title %}Home{% endblock %}

{% block content %}
<div class="panel panel-primary">
  <div class="panel-heading">
    <h3 class="panel-title"><a href="{% url 'board:shoutbox' %}">Shoutbox</a></h3>
  </div>
</div>
<div class="row">
  <div class="col-xs-12 col-sm-12 col-md-8 col-lg-9">
    {% for category in categories %}
    <div class="panel panel-primary">
      <div class="panel-heading">
        <h3 class="panel-title"><a href="{% url 'board:category' category.parent.id %}">{{category.parent.name}}</a></h3>
      </div>
      <table class="table">
        <thead>
          <tr>
            <th>
              Topic
            </th>
            <th class="align-center" width="10%">
              Posts
            </th>
            <th class="align-right" width="30%">
              Last Post
            </th>
          </tr>
        </thead>
        <tbody>
          {% for child in category.children %}
          <tr>
            <td>
              <a href="{% url 'board:topic' child.category.id %}">{{child.category.name}}</a>
              <a href="{% url 'board:new_post' child.category.id %}"><i class="fa fa-plus" aria-hidden="true"></i></a>
              <p>{{child.category.description.rendered}}</p>
            </td>
            <td class="align-center">
              {{child.num_posts}}
            </td>
            <td class="align-right">
              {% if child.last_post %}
              <a href="{% url 'board:post' child.last_post.id %}">{{child.last_post.title|truncatechars_html:30}}</a>
              <p>{{child.last_post.created|date:'D, M d, Y'}}</p>
              <p>by <a href="{% url 'users:profile' child.last_post.user.username %}">{{child.last_post.user.username}}</a></p>
              {% else %}
              <p>No Posts</p>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% endfor %}
  </div>
  <div class="col-xs-12 col-sm-12 col-md-4 col-lg-3">
    <div class="panel panel-primary">
      <div class="panel-heading">
        <h3 class="panel-title">Recent Posts</h3>
      </div>
      <div class="panel-body">
        <div class="container-fluid">
          {% for post in recent_posts_query.recents %}
          <div class="row">
            <div class="col-xs-1 col-sm-1 col-md-3 col-lg-3">
              <img src="/media/{{ post.user.image }}" alt="{{ post.user.username }}" />
            </div>
            <div class="col-xs-11 col-sm-11 col-md-9 col-lg-9">
              <a href="{% url 'board:post' post.id %}">{{post.title}}</a>
              <p>{{post.created|date:'D, M d, Y'}}</p>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
    <div class="panel panel-primary">
      <div class="panel-heading">
        <h3 class="panel-title">Recent Activity</h3>
      </div>
      <div class="panel-body">
        <div class="container-fluid">
          {% for post in recent_activity_query.recents %}
          <div class="row">
            <div class="col-xs-1 col-sm-1 col-md-3 col-lg-3">
              <img src="/media/{{ post.user.image }}" alt="{{ post.user.username }}" />
            </div>
            <div class="col-xs-11 col-sm-11 col-md-9 col-lg-9">
              <a href="{% url 'board:post' post.id %}">{{post.title}}</a>
              <p>{{post.created|date:'D, M d, Y'}}</p>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
    <div class="panel panel-success">
      <div class="panel-heading">
        <h3 class="panel-title">Side section</h3>
      </div>
      <div class="panel-body">
      </div>
    </div>
    <div class="panel panel-info">
      <div class="panel-heading">
        <h3 class="panel-title">Side section</h3>
      </div>
      <div class="panel-body">
      </div>
    </div>
    <div class="panel panel-warning">
      <div class="panel-heading">
        <h3 class="panel-title">Side section</h3>
      </div>
      <div class="panel-body">
      </div>
    </div>
    <div class="panel panel-danger">
      <div class="panel-heading">
        <h3 class="panel-title">Side section</h3>
      </div>
      <div class="panel-body">
      </div>
    </div>
  </div>
</div>
{% endblock %}
