{% extends 'punkweb_boards/themes/punkweb-new/base.html' %}
{% load humanize %}

{% block title %}Index{% endblock %}

{% block content %}
<div class="container">
  {% if BOARD_SETTINGS.USER_BIRTHDAY_MESSAGE %}
  {% include 'punkweb_boards/themes/punkweb-new/includes/birthday.html' %}
  {% endif %}
  {% for category in categories %}
  <a name="{{category.parent.name}}"></a>
  <table class="table">
    <thead data-role="collapsible-toggle" data-key="index-category-{{category.parent.id}}">
      <tr>
        <th>
          <a href="{% url 'board:category-detail' category.parent.id %}">{{category.parent.name}}</a>
        </th>
        <th>
          Threads
        </th>
        <th>
          Posts
        </th>
        <th>
          Last Thread
        </th>
      </tr>
    </thead>
    <tbody data-role="collapsible" data-key="index-category-{{category.parent.id}}">
      {% for child in category.children %}
      <tr>
        <td>
          <div><a href="{% url 'board:subcategory-detail' child.id %}">{{child.name}}</a></div>
          <div>{{child.description.rendered}}</div>
        </td>
        <td>
          <div>{{child.thread_count}}</div>
        </td>
        <td>
          <div>{{child.post_count}}</div>
        </td>
        <td>
          {% if child.last_thread %}
          <div>
            <a href="{% url 'board:thread' child.last_thread.id %}">
              {{child.last_thread.title|truncatechars_html:50}}
            </a>
          </div>
          <div>{{child.last_thread.created|date:"d M Y, g:i A"}}</div>
          <div>by
            <a href="{% url 'board:profile' child.last_thread.user.username %}">
              {{child.last_thread.user.profile.rendered_username}}
            </a>
          </div>
          {% else %}
          <div>No Threads</div>
          {% endif %}
        </td>
      </tr>
      {% empty %}
      <tr>
        <td>No subcategories have been created here yet.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% empty %}
  <p>This board doesn't have any categories yet</p>
  {% endfor %}
  <div class="panel">
    <div class="panel-header" data-role="collapsible-toggle" data-key="index-users-online">
      <div class="panel-title">Users Online</div>
    </div>
    <div class="panel-body" data-role="collapsible" data-key="index-users-online">
      {% for user in users_online %}
      <a href="{% url 'board:profile' user.username %}">{{user.profile.rendered_username}}</a>
      {% empty %}
      <span>No users are online</span>
      {% endfor %}
    </div>
  </div>
  <div class="panel">
    <div class="panel-header" data-role="collapsible-toggle" data-key="index-recent-threads">
      <div class="panel-title">Recent Threads</div>
    </div>
    <div class="panel-body" data-role="collapsible" data-key="index-recent-threads">
      {% if recent_threads %}
      {% for thread in recent_threads %}
      <div>
        <a href="{% url 'board:thread' thread.id %}">{{thread.title}}</a>
        <div>{{thread.created|naturaltime}}</div>
        <div>by
          <a href="{% url 'board:profile' thread.user.username %}">
            {{thread.user.profile.rendered_username}}
          </a>
        </div>
      </div>
      {% endfor %}
      {% else %}
      No recent threads
      {% endif %}
    </div>
  </div>
  <div class="panel">
    <div class="panel-header" data-role="collapsible-toggle" data-key="index-recent-activity">
      <div class="panel-title">Recent Activity</div>
    </div>
    <div class="panel-body" data-role="collapsible" data-key="index-recent-activity">
      {% if recent_activity %}
      {% for thread in recent_activity %}
      <div>
        <a href="{% url 'board:thread' thread.id %}">{{thread.title}}</a>
        <div>{{thread.modified|naturaltime}}</div>
        {% if thread.last_post.user %}
        <div>by
          <a href="{% url 'board:profile' thread.last_post.user.username %}">
            {{thread.last_post.user.profile.rendered_username}}
          </a>
        </div>
        {% else %}
        <div>by
          <a href="{% url 'board:profile' thread.user.username %}">
            {{thread.user.profile.rendered_username}}
          </a>
        </div>
        {% endif %}
      </div>
      {% endfor %}
      {% else %}
      No recent activity
      {% endif %}
    </div>
  </div>
  <table data-role="collapsible-toggle" data-key="index-staff-online">
    <thead>
      <tr>
        <th>Staff Online</th>
      </tr>
    </thead>
    <tbody data-role="collapsible" data-key="index-staff-online">
      {% for user in staff_online %}
      <tr>
        <td>
          <img src="{{user.profile.avatar_smallest}}" alt="">
        </td>
        <td>
          <a href="{% url 'board:profile' user.username %}">{{user.profile.rendered_username}}</a>
        </td>
      {% empty %}
        <td>
          <span>No staff members are online</span>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  <a name="statistics"></a>
  <div class="panel">
    <div class="panel-header" data-role="collapsible-toggle" data-key="index-statistics">
      <div class="panel-title">Statistics</div>
    </div>
    <div class="panel-body" data-role="collapsible" data-key="index-statistics">
      <div>
        <div>
          <label>Total posts</label>
          <span>{{total_posts}}</span>
        </div>
        <div>
          <label>Total threads</label>
          <span>{{total_threads}}</span>
        </div>
        <div>
          <label>Total members</label>
          <span>{{member_count}}</span>
        </div>
        {% if newest_member %}
        <div>
          <label>Newest member</label>
          <span>
            <a href="{% url 'board:profile' newest_member.username %}">
              {{newest_member.profile.rendered_username}}
            </a>
          </span>
        </div>
        {% else %}
        <div>No members</div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
