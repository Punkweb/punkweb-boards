/* SCEditor v3.0.0 | (C) 2017, Sam Clarke | sceditor.com/license */

!function(){"use strict";sceditor.plugins.undo=function(){function r(e){l=!0,u=e.value,o.sourceMode(e.sourceMode),o.val(e.value,!1),o.focus(),e.sourceMode?o.sourceEditorCaret(e.caret):o.getRangeHelper().restoreRange(),l=!1}var o,u,e=this,a=0,n=50,c=[],s=[],l=!1;e.init=function(){n=(o=this).undoLimit||n,o.addShortcut("ctrl+z",e.undo),o.addShortcut("ctrl+shift+z",e.redo),o.addShortcut("ctrl+y",e.redo)},e.undo=function(){var e=s.pop(),t=o.val(null,!1);return(e=e&&!c.length&&t===e.value?s.pop():e)&&(c.length||c.push({caret:o.sourceEditorCaret(),sourceMode:o.sourceMode(),value:t}),c.push(e),r(e)),!1},e.redo=function(){var e=c.pop();return s.length||(s.push(e),e=c.pop()),e&&(s.push(e),r(e)),!1},e.signalReady=function(){var e=o.val(null,!1);u=e,s.push({caret:this.sourceEditorCaret(),sourceMode:this.sourceMode(),value:e})},e.signalValuechangedEvent=function(e){var t=e.detail.rawValue;0<n&&s.length>n&&s.shift(),!l&&u&&u!==t&&(c.length=0,(a+=function(e,t){for(var r,o,u,a=e.length,n=t.length,c=Math.max(a,n),s=0;s<c&&e.charAt(s)===t.charAt(s);s++);for(o=a<n?n-a:0,u=n<a?a-n:0,r=c-1;0<=r&&e.charAt(r-o)===t.charAt(r-u);r--);return r-s+1}(u,t))<20||a<50&&!/\s$/g.test(e.rawValue)||(s.push({caret:o.sourceEditorCaret(),sourceMode:o.sourceMode(),value:t}),a=0,u=t))}}}();